# 口头对战游戏 - UI 设计文档

> 版本: v1.1 | 更新日期: 2026-02-08
> 画布尺寸: 响应式（max 1440×900，逻辑基准 960×540）
> 美术风格: 中式仙侠暖金色调 + 曹操传像素精美度
>
> **注意**: 视觉设计（配色、布局）以 `ui-prototype/index.html` 为准。本文档定义信息架构和交互流程。

---

## 一、屏幕流转图

### 1.1 完整流程

```
┌──────────────┐
│   标题画面    │
│  TitleScreen  │
└──────┬───────┘
       │ 点击"开始游戏"
       ▼
┌──────────────┐
│ 玩家数量选择  │
│ PlayerCount   │
└──────┬───────┘
       │ 选择 2-8 人
       ▼
┌──────────────┐
│   角色选择    │
│ CharSelect    │
└──────┬───────┘
       │ 确认选择
       ▼
┌──────────────┐       ┌──────────────┐
│   战斗画面    │──────→│   结算画面    │
│  BattleScene  │ 胜负  │ ResultScreen  │
└──────────────┘ 判定   └──────┬───────┘
       ▲                       │
       │                       │ "再来一局"
       │           ┌───────────┤
       │           │           │ "返回标题"
       │           ▼           ▼
       │    ┌──────────┐  ┌──────────────┐
       └────│ 角色选择  │  │   标题画面    │
            └──────────┘  └──────────────┘
```

### 1.2 屏幕详细定义

---

#### 画面 1: 标题画面 (TitleScreen)

**进入条件**: 游戏加载完成 / 结算画面点击"返回标题"

**UI 元素**:

| 元素 | 位置 | 尺寸 | 说明 |
|------|------|------|------|
| 游戏标题 | 水平居中, Y=140 | 字号 48px | 像素字体，游戏名称 |
| 副标题 | 水平居中, Y=200 | 字号 16px | "回合制策略对战" |
| 战斗场景预览 | 居中, Y=240~380 | 400x140 | 三个角色待机动画展示（装饰性） |
| "开始游戏" 按钮 | 水平居中, Y=420 | 200x50 | 主按钮，像素风格边框 |
| 版本号 | 右下角 (920, 520) | 字号 12px | "v1.0" |

**交互方式**:
- 点击 "开始游戏" → 过渡到「玩家数量选择」
- 角色预览自动循环播放待机动画（无交互）

**退出条件**: 点击"开始游戏"

**过渡动画**: 画面整体淡出（300ms）→ 淡入下一画面（300ms）

---

#### 画面 2: 玩家数量选择 (PlayerCountScreen)

**进入条件**: 标题画面点击"开始游戏"

**UI 元素**:

| 元素 | 位置 | 尺寸 | 说明 |
|------|------|------|------|
| 标题 "选择玩家数量" | 水平居中, Y=80 | 字号 32px | |
| 说明文字 | 水平居中, Y=130 | 字号 14px | "你将操控1名角色，其余由AI控制" |
| 数字按钮 2~8 | 水平居中排列, Y=220 | 每个 70x70 | 7个数字按钮，间距 15px |
| 当前选中提示 | 水平居中, Y=320 | 字号 18px | "已选择: X 人对战" |
| 对战说明 | 水平居中, Y=360 | 字号 14px | "1名玩家 vs X名AI" |
| "确认" 按钮 | 水平居中, Y=440 | 200x50 | 选择数量后可点击 |
| "返回" 按钮 | 左下角 (40, 490) | 100x36 | 返回标题画面 |

**交互方式**:
- 点击数字按钮选择人数（默认高亮 "3"）
- 选中的按钮高亮显示（亮色边框 + 放大到 80x80）
- 点击"确认" → 过渡到「角色选择」
- 点击"返回" → 过渡回「标题画面」

**退出条件**: 点击"确认"或"返回"

**过渡动画**: 滑动过渡（左滑进入、右滑返回），300ms

---

#### 画面 3: 角色选择 (CharacterSelectScreen)

**进入条件**: 玩家数量选择后点击"确认"

**UI 元素**:

| 元素 | 位置 | 尺寸 | 说明 |
|------|------|------|------|
| 标题 "选择你的角色" | 水平居中, Y=40 | 字号 28px | |
| 角色卡片 x3 | 水平均分排列, Y=80~400 | 每个 260x320 | 骑士 / 装甲战士 / 弓箭手 |
| 角色卡片 - 角色名 | 卡片内顶部 | 字号 20px | 居中显示 |
| 角色卡片 - 角色精灵 | 卡片内 Y=60~200 | 96x96 (放大显示) | 播放待机动画 |
| 角色卡片 - 定位标签 | 卡片内精灵下方 | 字号 12px | "均衡型" / "坦克型" / "远程型" |
| 角色卡片 - 属性条 | 卡片内 Y=220~300 | 200x16 每条 | HP/MP/AGI/DEF 四条属性条 |
| 角色卡片 - 技能图标 | 卡片内底部 | 24x24 x N | 技能小图标（hover显示名称） |
| "确认出战" 按钮 | 水平居中, Y=440 | 200x50 | 选中角色后可点击 |
| "返回" 按钮 | 左下角 (40, 490) | 100x36 | 返回人数选择 |
| 对战信息 | 右下角 (700, 490) | 字号 14px | "X人对战 | AI角色将随机分配" |

**交互方式**:
- 点击角色卡片选中（选中卡片高亮 + 上移 10px + 光边框）
- 未选中卡片降低亮度（opacity: 0.6）
- hover 角色卡片时显示详细技能说明（tooltip）
- 点击"确认出战" → 过渡到「战斗画面」
- 点击"返回" → 过渡回「玩家数量选择」

**退出条件**: 点击"确认出战"

**过渡动画**: 选中角色放大居中 → 画面渐暗 → 战斗场景淡入（总计 800ms）

**备注**: AI 角色在进入战斗画面时自动分配，角色可重复（多个AI可选同一角色）

---

#### 画面 4: 战斗画面 (BattleScene)

**进入条件**: 角色选择确认后

**UI 元素**: 详见「第二章：战斗界面布局规格」

**交互方式**: 详见「第三章：回合交互流程」

**退出条件**: 游戏结束（仅剩1名存活者）

**过渡动画**: 最后一击慢放 → 画面渐暗 → 结算画面淡入（总计 1200ms）

---

#### 画面 5: 结算画面 (ResultScreen)

**进入条件**: 战斗结束，仅剩1名存活者

**UI 元素**:

| 元素 | 位置 | 尺寸 | 说明 |
|------|------|------|------|
| 胜负标题 | 水平居中, Y=60 | 字号 40px | "胜利!" (金色) 或 "败北..." (灰色) |
| 获胜角色精灵 | 水平居中, Y=120~260 | 128x128 (放大) | 播放待机动画，带光环特效 |
| 获胜角色名 | 水平居中, Y=280 | 字号 24px | 角色名 + 操控者标记 (玩家/AI) |
| 战斗统计面板 | 水平居中, Y=310~420 | 600x110 | 半透明暗色面板 |
| 统计 - 总回合数 | 面板内左侧 | 字号 16px | "总回合: X" |
| 统计 - 总伤害输出 | 面板内中部 | 字号 16px | "造成伤害: XXXX" |
| 统计 - 击杀数 | 面板内右侧 | 字号 16px | "击杀: X" |
| "再来一局" 按钮 | X=280, Y=460 | 180x50 | 保持人数，重新选角色 |
| "返回标题" 按钮 | X=500, Y=460 | 180x50 | 返回标题画面 |

**交互方式**:
- 点击"再来一局" → 过渡到「角色选择」（保持之前选的人数）
- 点击"返回标题" → 过渡到「标题画面」

**退出条件**: 点击任一按钮

**过渡动画**: 淡出（300ms）→ 淡入目标画面（300ms）

---

## 二、战斗界面布局规格

### 2.1 整体布局概览

响应式画布（max 1440×900），逻辑基准 960×540。

> **设计决策（v1.1 更新）**：本游戏为全员混战（Free-for-all），每个角色独立。
> 采用**动态布局**：玩家角色固定在底部居中（面朝北），对手角色在上方对称分布（面朝南）。
> 此布局兼顾"玩家视角沉浸感"和"全员混战公平性"。
>
> 4方向素材：玩家用 N 方向帧，对手用 S 方向帧，左右对手间互攻用 E/W。

```
┌────────────────── 响应式 (max 1440px) ──────────────────┐
│ ┌──────────────────────────────────────────────────────┐ │
│ │  回合信息栏: 回合数 | 行动顺序肖像 | 存活数 | 状态   │ │
│ └──────────────────────────────────────────────────────┘ │
│                                                          │
│    ┌─────────┐                      ┌─────────┐         │
│    │ 对手1   │                      │ 对手2   │         │
│    │ (面朝S) │        战斗区域       │ (面朝S) │         │
│    └─────────┘                      └─────────┘         │
│                    ┌─────────┐                           │
│                    │ 玩家    │                           │
│                    │ (面朝N) │                           │
│                    └─────────┘                           │
│ ┌─────────────────────────┐┌────────────────────────┐   │
│ │  动作面板 + 确认         ││ 玩家状态条 + 战斗日志  │   │
│ └─────────────────────────┘└────────────────────────┘   │
└──────────────────────────────────────────────────────────┘
```

#### 各人数布局规则

| 人数 | 玩家位置 | 对手排列 |
|------|----------|----------|
| 2人 | 底部居中 | 正上方居中 1个 |
| 3人 | 底部居中 | 上方左右对称 2个 |
| 4人 | 底部居中 | 上方弧形均匀 3个 |
| 5-8人 | 底部居中 | 上方弧形均匀分布，人数越多间距越小，6+人缩放至85% |

### 2.2 区域坐标定义

#### A. 回合信息栏

| 属性 | 值 |
|------|-----|
| 位置 | x=10, y=5 |
| 尺寸 | 940 x 35 |
| 背景 | 半透明黑色 (rgba(0,0,0,0.6)) |
| 圆角 | 4px |

| 元素 | 位置 | 字号 | 颜色 |
|------|------|------|------|
| "第 X 回合" | 左侧 (x=20, y=12) | 16px | #FFD700 (金色) |
| 存活人数 "存活: X/Y" | 右侧 (x=880, y=12, 右对齐) | 14px | #CCCCCC |

#### B. 角色区域（弧形排列）

所有角色排成弧形，无阵营区分。玩家角色有金色★标记。

| 属性 | 值 |
|------|-----|
| 区域范围 | x=40~900, y=30~340 (可用站位区域) |
| 排列方式 | 弧形/椭圆弧，玩家在底部偏左 |
| 朝向 | 所有角色默认面朝南（S方向帧） |
| 最大人数 | 8 |

**弧形排列**：所有角色沿弧线均匀分布，玩家始终在最左下方。

#### C. 角色站位坐标

弧形排列，根据总人数动态计算坐标。以画布中心 (480, 180) 为弧心。

**站位计算公式**:
```
// 弧形参数
centerX = 480, centerY = 180
radiusX = 320, radiusY = 140
// 弧形范围: 从 210° 到 330°（底部开口弧）
startAngle = 210°, endAngle = 330°
angleStep = (endAngle - startAngle) / (totalCount - 1)

// 第 i 个角色 (i 从 0 开始)
angle = startAngle + angleStep * i
x = centerX + radiusX * cos(angle)
y = centerY - radiusY * sin(angle)
```

**各人数时的示例坐标**:

| 人数 | 排列示意 |
|------|----------|
| 2 | 左下 ←→ 右下 |
| 3 | 左下 — 上中 — 右下 (倒三角) |
| 4 | 左下 — 左上 — 右上 — 右下 |
| 5-8 | 弧线均匀分布，人数越多间距越小 |

**3人具体坐标（最常用）**:

| 角色 | 位置描述 | X | Y |
|------|----------|---|---|
| 角色1（玩家） | 左下 | 120 | 260 |
| 角色2 | 上中 | 430 | 60 |
| 角色3 | 右下 | 740 | 260 |

**8人具体坐标**:

| 角色 | X | Y | 缩放 |
|------|---|---|------|
| 角色1（玩家） | 80 | 280 | 0.85 |
| 角色2 | 160 | 140 | 0.85 |
| 角色3 | 280 | 50 | 0.85 |
| 角色4 | 420 | 30 | 0.85 |
| 角色5 | 540 | 30 | 0.85 |
| 角色6 | 680 | 50 | 0.85 |
| 角色7 | 800 | 140 | 0.85 |
| 角色8 | 880 | 280 | 0.85 |

> 6人以上时角色缩放至 85%，避免拥挤。

#### D. 角色资源条 (HP/MP/RAGE)

每个角色头顶显示三条资源条，从上到下分别为 HP、MP、RAGE。

| 属性 | 值 |
|------|-----|
| 资源条宽度 | 60px |
| 资源条高度 | 6px (每条) |
| 条间距 | 2px |
| 距角色精灵 | 角色顶部上方 8px |
| 背景色 | rgba(0,0,0,0.5) |
| 边框 | 1px #333333 |

| 资源条 | 填充颜色 | 低值警告 (< 25%) |
|--------|---------|-----------------|
| HP | #22CC44 (绿) | #CC2222 (红) + 闪烁 |
| MP | #4488FF (蓝) | #6644AA (暗紫) |
| RAGE | #FF6600 (橙) | 无警告（怒气是向上涨的） |

**RAGE 特殊显示**: 当 RAGE >= 60 时（可放大招），RAGE 条发光脉冲动画。

#### E. 角色名牌

| 属性 | 值 |
|------|-----|
| 位置 | 资源条上方 4px |
| 字号 | 11px |
| 颜色 | 玩家 = #FFD700 (金色), AI = #BBBBBB (灰白) |
| 内容 | "角色名 (玩家)" 或 "角色名 #N" |

#### F. 状态 Buff 图标

| 属性 | 值 |
|------|-----|
| 位置 | 角色精灵正上方（居中） |
| 图标尺寸 | 16x16 px |
| 最大显示数 | 3个横排 |
| 间距 | 2px |
| 有效状态 | 顶盾(盾牌图标+回合数)、反震(波纹图标)、游击战术(速度箭头)、马鞭(马蹄图标) |

#### G. 动作面板

仅在玩家回合时显示，位于画面右下区域。

| 属性 | 值 |
|------|-----|
| 面板位置 | x=320, y=380 |
| 面板尺寸 | 630 x 155 |
| 面板背景 | 半透明暗色 (rgba(15, 15, 25, 0.85)) |
| 边框 | 2px #445566 |
| 圆角 | 6px |

**按钮布局 (3列 x 3行网格)**:

| 属性 | 值 |
|------|-----|
| 按钮尺寸 | 190 x 42 |
| 按钮间距 | 水平 10px, 垂直 6px |
| 按钮起始位置 | 面板内 x=10, y=8 |
| 按钮样式 | 像素风格边框，深色底 |

| 行 | 列1 (x=330) | 列2 (x=530) | 列3 (x=730) |
|----|-------------|-------------|-------------|
| 行1 (y=388) | 普通攻击 | 防御 | 逃跑 |
| 行2 (y=436) | 技能1 | 技能2 | 技能3 |
| 行3 (y=484) | 技能4 | 技能5 | 技能6 |

**按钮内容显示**:
- 按钮文字: 技能名 (左对齐, 14px)
- 消耗标记: 右侧小字 (11px)，如 "10 MP" / "60 RAGE"
- 不可用状态: 按钮灰色 + 半透明 (opacity: 0.4)，显示不可用原因
- hover 状态: 亮色边框 + 按钮底色变亮
- 选中状态: 高亮金色边框

#### H. 战斗日志

| 属性 | 值 |
|------|-----|
| 位置 | x=10, y=380 |
| 尺寸 | 300 x 155 |
| 背景 | 半透明黑色 (rgba(0, 0, 0, 0.7)) |
| 边框 | 1px #333333 |
| 圆角 | 6px |
| 最大显示行数 | 8 行 |
| 字号 | 12px |
| 滚动 | 新消息出现时自动滚动到底部 |

**日志消息颜色**:

| 类型 | 颜色 | 示例 |
|------|------|------|
| 系统提示 | #AAAAAA (灰) | "第 3 回合开始" |
| 玩家动作 | #FFD700 (金) | "你 使用了 升龙击 → 装甲战士#2" |
| AI动作 | #88AACC (浅蓝) | "弓箭手#1 使用了 太阳之弓 → 你" |
| 伤害数值 | #FF4444 (红) | "造成 51.00 点伤害" |
| 治疗/增益 | #44FF88 (绿) | "顶盾生效，韧性+2 (剩余2回合)" |
| 闪避 | #FFAA00 (橙) | "逃跑成功！闪避了攻击" |
| 击杀 | #FF0000 (亮红) | "装甲战士#2 被击败！" |

#### I. 目标选择指示器

当玩家选择需要指定目标的技能时，其他存活角色显示可选择标记。

| 属性 | 值 |
|------|-----|
| 指示器类型 | 角色精灵下方的箭头 + 角色边缘高亮框 |
| 高亮框颜色 | #FF4444 (红色虚线) 可选目标（所有其他存活角色） |
| 选中框颜色 | #FFD700 (金色实线) 已选中目标 |
| hover 效果 | 角色精灵亮度提升 + 名牌放大 |
| 多目标提示 | 左上角显示 "选择目标 (1/2)" 字样（长虹贯日用） |

#### J. 伤害弹出数字

| 属性 | 值 |
|------|-----|
| 初始位置 | 受击角色精灵中心 |
| 字号 | 普通伤害 22px, 暴击/高伤 28px |
| 动画 | 向上飘动 60px + 淡出, 持续 800ms |
| 伤害颜色 | #FF3333 (红) |
| 治疗颜色 | #33FF66 (绿) |
| Miss/闪避 | #FFAA00 (橙), 显示 "MISS" |
| 真实伤害 | #FF00FF (紫), 带光芒特效 |

### 2.3 字体规格

| 用途 | 字号 | 字体 | 备注 |
|------|------|------|------|
| 画面标题 | 40~48px | 像素字体 (Press Start 2P 或 zpix) | 仅标题/结算画面 |
| 区域标题 | 28~32px | 像素字体 | 选择画面标题 |
| 按钮文字 | 14~16px | 像素字体 | 技能按钮 |
| 消耗标记 | 11px | 像素字体 | MP/RAGE 消耗 |
| 日志文字 | 12px | 像素字体 | 战斗日志 |
| 角色名 | 11px | 像素字体 | 名牌 |
| 伤害数字 | 22~28px | 像素字体 (加粗) | 弹出伤害 |
| 提示/说明 | 12~14px | 系统字体回退 | tooltip |

**推荐字体**: `zpix` (支持中文像素字体) 作为主字体，`"Press Start 2P"` 作英文回退。

### 2.4 战斗画面完整坐标总图（3人示例）

```
(0,0)───────────────────────────────────────────────────────(960,0)
│ ┌──── 回合信息栏 ──────────────────────────────────────┐  │
│ │ (10,5)  回合 3    [行动顺序条]        存活 3/3 (950) │  │
│ └──────────────────────────────────────────────────────┘  │
│                                                           │
│                      ┌───────┐                            │
│                      │ 角色2  │(430, 60)                  │
│                      │装甲战士│                            │
│                      └───────┘                            │
│                     /          \                          │
│          ┌───────┐              ┌───────┐                │
│          │ 角色1  │(120, 260)    │ 角色3  │(740, 260)     │
│          │骑士 ★  │              │ 弓箭手  │               │
│          └───────┘              └───────┘                │
│                                                           │
│ ┌── 战斗日志 ──────┐ ┌──── 动作面板 ──────────────────┐  │
│ │ (10,380)         │ │ (320,380)                      │  │
│ │                  │ │  [普攻] [防御] [逃跑]           │  │
│ │  日志消息...      │ │  [技能1][技能2][技能3]          │  │
│ │                  │ │  [技能4][技能5][技能6]          │  │
│ │          (310,535)│ │                       (950,535)│  │
│ └──────────────────┘ └────────────────────────────────┘  │
(0,540)─────────────────────────────────────────────────(960,540)
```

---

## 三、回合交互流程

### 3.1 状态机定义

战斗画面使用有限状态机（FSM）管理回合流程。

```
┌─────────────────────────────────────────────────────────────┐
│                     BattleStateMachine                       │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────┐                                                │
│  │ BATTLE_  │──初始化完成──→┌──────────┐                     │
│  │  INIT    │               │ TURN_    │                     │
│  └──────────┘               │  START   │◄────────────┐      │
│                              └────┬─────┘             │      │
│                                   │                   │      │
│                          被动/持续效果处理              │      │
│                                   │                   │      │
│                                   ▼                   │      │
│                           ┌──────────────┐            │      │
│                      ┌───→│ ACTION_SELECT │            │      │
│                      │    └──────┬───────┘            │      │
│                      │           │                    │      │
│               取消选择  玩家选择完毕                    │      │
│                      │           │                    │      │
│                      │           ▼                    │      │
│                      │    ┌──────────────┐            │      │
│                      └────│ TARGET_SELECT │            │      │
│                           └──────┬───────┘            │      │
│                                  │                    │      │
│                            确认目标                    │      │
│                                  │                    │      │
│                                  ▼                    │      │
│                           ┌──────────────┐            │      │
│                           │  AI_DECIDE   │            │      │
│                           └──────┬───────┘            │      │
│                                  │                    │      │
│                            AI决策完成                   │      │
│                                  │                    │      │
│                                  ▼                    │      │
│                           ┌──────────────┐            │      │
│                           │  RESOLVE     │            │      │
│                           │ (按AGI逐个)   │            │      │
│                           └──────┬───────┘            │      │
│                                  │                    │      │
│                            所有动作结算完              │      │
│                                  │                    │      │
│                                  ▼                    │      │
│                           ┌──────────────┐            │      │
│                           │  TURN_END    │            │      │
│                           └──────┬───────┘            │      │
│                                  │                    │      │
│                          ┌───────┴───────┐            │      │
│                          │               │            │      │
│                    存活>1人         存活<=1人          │      │
│                          │               │            │      │
│                          │               ▼            │      │
│                          │       ┌──────────┐         │      │
│                          └──────→│ 下一回合  │─────────┘      │
│                                  └──────────┘                │
│                                         (存活<=1时)          │
│                                              │               │
│                                              ▼               │
│                                      ┌──────────┐           │
│                                      │ BATTLE_  │           │
│                                      │  END     │           │
│                                      └──────────┘           │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 各状态详细描述

---

#### 状态 1: BATTLE_INIT (战斗初始化)

**触发**: 从角色选择画面进入战斗

**处理内容**:
1. 初始化所有角色属性（HP=MAX, MP=MAX, RAGE=0）
2. 角色精灵加载到对应站位
3. 资源条初始化
4. 战斗日志清空
5. 回合数设为 1
6. 播放入场动画（角色从画面外滑入站位）

**UI 表现**:
- 角色依次从画面两侧滑入各自站位（每个角色间隔 200ms）
- 资源条从0填满到初始值（动画 500ms）
- 战斗日志显示: "战斗开始！"

**持续时间**: 约 2000ms（入场动画）

**转移条件**: 入场动画播放完毕 → 进入 `TURN_START`

---

#### 状态 2: TURN_START (回合开始)

**触发**: 战斗初始化完成 / 上一回合结束

**处理内容**:
1. 回合数 +1（首回合除外）
2. 被动技能触发:
   - 装甲战士「钢铁意志」: +5 怒气
3. 持续效果处理:
   - 顶盾回合数 -1（到0则移除）
4. （反震在RESOLVE阶段最先结算，不在此处处理）

**UI 表现**:
- 回合信息栏更新回合数（数字放大弹跳动画）
- 战斗日志: "--- 第 X 回合 ---"
- 被动触发时:
  - 装甲战士头顶浮出 "+5 怒气" 文字（橙色, 上飘）
  - RAGE 条增长动画
- 顶盾到期时:
  - 盾牌图标消失动画
  - 战斗日志: "装甲战士#N 的顶盾效果消失"

**持续时间**: 800ms ~ 1500ms（取决于被动数量）

**转移条件**: 所有被动效果处理完毕 → 进入 `ACTION_SELECT`

---

#### 状态 3: ACTION_SELECT (动作选择)

**触发**: 回合开始处理完毕

**处理内容**:
1. 动作面板滑入显示
2. 根据当前资源情况禁用不可用技能
3. 等待玩家选择动作

**UI 表现**:
- 动作面板从底部滑入（200ms）
- 玩家角色精灵播放 "等待" 呼吸动画（轻微上下浮动）
- 玩家角色高亮边框（表示轮到你了）
- 按钮状态计算:
  - MP 不足 → 对应技能按钮灰色，显示 "MP不足"
  - RAGE 不足 → 对应技能按钮灰色，显示 "怒气不足"
  - HP 不足（冲锋需要 >10 HP）→ 按钮灰色，显示 "HP不足"
- 顶部提示文字: "选择本回合动作" (闪烁)

**玩家交互**:
- hover 按钮 → 显示技能详细说明 tooltip（包含消耗、伤害、条件效果）
- 点击按钮 → 选中动作:
  - 若动作不需要选择目标（防御/逃跑/马鞭/顶盾/反震）→ 直接确认，进入 `AI_DECIDE`
  - 若动作需要选择目标 → 进入 `TARGET_SELECT`

**持续时间**: 无限制（等待玩家操作）

**转移条件**:
- 选择无目标动作 → `AI_DECIDE`
- 选择需要目标的动作 → `TARGET_SELECT`

---

#### 状态 4: TARGET_SELECT (目标选择)

**触发**: 玩家选择了需要指定目标的动作

**处理内容**:
1. 在可选目标上显示指示器
2. 等待玩家点击目标角色

**UI 表现**:
- 动作面板缩小或半透明化（保持可见但不再是焦点）
- 所选动作按钮保持高亮
- 所有存活的其他存活角色显示红色虚线框（可选目标）
- 顶部提示:
  - 单目标技能: "选择攻击目标"
  - 长虹贯日: "选择目标 (最多2个)" + 已选数量
- 显示"取消"按钮（返回动作选择）

**玩家交互**:
- hover 其他存活角色 → 高亮 + 显示目标详细属性（HP/MP/RAGE/状态）
- 点击其他存活角色 → 选中为目标
  - 单目标: 选中后直接确认
  - 多目标（长虹贯日）: 选中第一个后等待选第二个，或点击 "确认" 跳过
- 点击已选目标 → 取消选择
- 点击 "取消" 按钮 → 返回 `ACTION_SELECT`

**长虹贯日特殊处理**:
- 选择第1个目标后，该目标显示金色实线框 + "1" 标记
- 可继续选第2个不同目标，显示 "2" 标记
- 同一目标不可重复选择（点击已选目标会取消它）
- 选完后显示"确认"按钮，或选满2个自动确认

**持续时间**: 无限制（等待玩家操作）

**转移条件**:
- 确认目标 → `AI_DECIDE`
- 点击取消 → `ACTION_SELECT`

---

#### 状态 5: AI_DECIDE (AI 决策)

**触发**: 玩家完成动作+目标选择

**处理内容**:
1. AI 为所有 AI 控制的角色选择动作和目标
2. 使用博弈树+Softmax 策略计算最优行动

**UI 表现**:
- 动作面板隐藏（滑出，200ms）
- 画面中央显示 "AI 思考中..." 文字 + 转圈点动画
- AI 角色精灵依次闪烁（表示在思考），每个角色 300ms
- 持续 1000~1500ms（实际计算很快，但故意延迟以增加沉浸感）

**持续时间**: 1000ms ~ 1500ms（人工延迟）

**转移条件**: AI 决策完成 → `RESOLVE`

---

#### 状态 6: RESOLVE (动作结算)

**触发**: 所有角色（玩家+AI）均已选择动作

**处理内容**:
1. 按敏捷值从高到低排序所有存活角色
2. 敏捷相同则随机排序
3. 依次结算每个角色的动作

**结算每个角色动作的子流程**:

```
┌─────────────────────────────────────────────────┐
│            RESOLVE 子流程 (每个角色)               │
├─────────────────────────────────────────────────┤
│                                                  │
│  1. 检查角色是否存活                               │
│     └── 已死亡 → 跳过（日志: "XX 已阵亡，动作取消"） │
│                                                  │
│  2. 显示行动者高亮 (300ms)                         │
│     └── 行动者精灵亮度提升 + 名牌放大               │
│                                                  │
│  3. 播放动作动画                                   │
│     ├── 普攻: 攻击动画 → 投射物/斩击光效 → 受击      │
│     ├── 近战技能: 技能动画 → 斩击特效 → 受击         │
│     ├── 远程技能: 技能动画 → 箭矢飞行 → 受击         │
│     ├── 防御: 防御姿态 + 盾牌叠加                   │
│     ├── 逃跑: 逃跑动画 + 成功/失败文字              │
│     └── Buff: 施法动画 + 状态图标出现               │
│                                                  │
│  4. 显示结果                                      │
│     ├── 伤害数字弹出 (向上飘动 800ms)               │
│     ├── 目标 HP 条减少动画 (400ms)                  │
│     ├── 目标 RAGE 条增加动画 (300ms)                │
│     ├── 条件触发文字（如 "追击！伤害x4"）            │
│     └── 反震反弹: 伤害线 + 攻击者受伤                │
│                                                  │
│  5. 死亡检查                                      │
│     └── HP <= 0 → 死亡动画 (800ms) → 移除角色       │
│                                                  │
│  6. 战斗日志记录                                   │
│                                                  │
│  7. 等待 300ms → 下一个角色                        │
│                                                  │
└─────────────────────────────────────────────────┘
```

**UI 表现 - 各动作类型**:

| 动作 | 动画序列 | 持续时间 |
|------|---------|---------|
| 普通攻击 (近战) | 攻击动画 → 角色前冲50px → 斩击光效 → 返回 → 受击闪烁 | ~1200ms |
| 普通攻击 (远程) | 攻击动画 → 箭矢飞行 → 命中特效 → 受击闪烁 | ~1000ms |
| 近战技能 | 技能名浮出 → 角色前冲 → 技能特效 → 返回 → 受击 | ~1500ms |
| 远程技能 | 技能名浮出 → 施法动画 → 投射物飞行 → 命中特效 → 受击 | ~1400ms |
| 防御 | 防御动画 → 盾牌半透明叠加 + "防御!" 文字 | ~600ms |
| 逃跑成功 | 角色向后移动 + 烟尘粒子 + "逃跑成功!" | ~800ms |
| 逃跑失败 | 角色摇晃 + "逃跑失败!" | ~600ms |
| Buff技能 | 施法动画 → 状态图标出现 → 效果文字 | ~800ms |
| 漫天花雨 | 施法动画 → 天空变暗 → 大量箭矢落下 → 全体受击 | ~2500ms |

**条件触发特殊表现**:

| 条件 | 额外表现 |
|------|---------|
| 追砍 + 目标逃跑 | 红色文字 "追击!" → 连续4次斩击特效 |
| 冲锋 + 目标逃跑 | 灰色文字 "无效..." → 冲锋动画在目标前停止 |
| 太阳之弓 + 目标用技能 | 蓝色文字 "克制!" → 箭矢变为双箭 |
| 反震触发 | 紫色波纹 → 反弹伤害线回到攻击者 → 攻击者受击 |
| 真实伤害 | 紫色伤害数字 + 暗色闪光 |

**持续时间**: 每个角色 ~1000-2500ms，总计取决于存活人数

**转移条件**: 所有角色动作结算完毕 → `TURN_END`

---

#### 状态 7: TURN_END (回合结束)

**触发**: 所有动作结算完毕

**处理内容**:
1. 清除本回合临时状态（防御状态、逃跑状态、反震状态）
2. 更新所有资源条到最终值
3. 最终死亡检查（处理同时死亡等边界情况）
4. 判断游戏是否结束

**UI 表现**:
- 所有资源条平滑过渡到当前值（若有延迟更新的情况）
- 防御姿态的角色恢复站立
- 逃跑的角色回到原位
- 短暂停顿 (500ms)

**持续时间**: ~500ms

**转移条件**:
- 存活角色 > 1 → 回到 `TURN_START`（下一回合）
- 存活角色 <= 1 → 进入 `BATTLE_END`

---

#### 状态 8: BATTLE_END (战斗结束)

**触发**: 仅剩 0 或 1 名存活角色

**处理内容**:
1. 确定获胜者
2. 计算战斗统计数据
3. 过渡到结算画面

**UI 表现**:
- 最后一击播放完毕后，画面暂停 500ms
- 获胜角色播放胜利动画（或待机动画 + 光环特效）
- 画面上方落下 "胜利!" 或 "败北..." 大字（800ms 缩放动画）
- 背景渐暗 (500ms)
- 过渡到结算画面 (500ms 淡入)

**持续时间**: ~2000ms

**转移条件**: 过渡动画完成 → 进入 `ResultScreen`

---

### 3.3 完整回合时序图

以一个 3 人对战（玩家骑士 vs AI装甲战士 vs AI弓箭手）的第 3 回合为例：

```
时间轴 ──────────────────────────────────────────────────────→

│ TURN_START (800ms)
│ ├── 日志: "--- 第 3 回合 ---"
│ ├── 装甲战士 钢铁意志 +5 怒气 (头顶浮出文字)
│ └── 顶盾剩余: 2→1 回合
│
│ ACTION_SELECT (等待玩家)
│ ├── 动作面板滑入
│ ├── 玩家查看技能 (hover tooltip)
│ └── 玩家点击 "追砍" (10 MP)
│
│ TARGET_SELECT (等待玩家)
│ ├── 其他存活角色显示红框
│ ├── 玩家点击 "弓箭手#1"
│ └── 确认目标
│
│ AI_DECIDE (1200ms)
│ ├── "AI 思考中..."
│ ├── 装甲战士选择: 冲锋 → 骑士
│ └── 弓箭手选择: 逃跑
│
│ RESOLVE (按AGI排序: 骑士7 > 弓箭手6 > 装甲战士4)
│ │
│ ├── 骑士 行动 (1500ms)
│ │   ├── 高亮骑士
│ │   ├── 日志: "你 使用了 追砍 → 弓箭手#1"
│ │   ├── 弓箭手选择了逃跑 → 触发追击 "追击！×4"
│ │   ├── 追砍动画 → 连续斩击特效
│ │   ├── 伤害: 15 × 4 × (10-1.5)/10 = 51.00
│ │   ├── 弹出 "51" (红色, 上飘)
│ │   ├── 弓箭手 HP 条减少
│ │   └── 弓箭手 RAGE +51
│ │
│ ├── 弓箭手 行动 (800ms)
│ │   ├── 高亮弓箭手
│ │   ├── 逃跑判定: 成功 (50%)
│ │   ├── 角色后移 + 烟尘 + "逃跑成功!"
│ │   └── 日志: "弓箭手#1 逃跑成功！"
│ │
│ └── 装甲战士 行动 (1200ms)
│     ├── 高亮装甲战士
│     ├── 日志: "装甲战士#1 使用了 冲锋 → 你"
│     ├── 骑士未逃跑 → 冲锋正常生效
│     ├── 冲锋动画 → 冲刺残影 → 受击
│     ├── 伤害: 75 × (10-2)/10 = 60.00
│     ├── 装甲战士 -10 HP (冲锋消耗)
│     ├── 弹出 "60" (红色, 骑士头顶)
│     ├── 骑士 HP 条减少
│     └── 骑士 RAGE +60
│
│ TURN_END (500ms)
│ ├── 清除逃跑状态
│ ├── 更新所有资源条
│ └── 存活检查 → 全部存活 → 下一回合
│
│ → 回到 TURN_START
```

### 3.4 快捷操作

| 操作 | 触发 | 效果 |
|------|------|------|
| 跳过动画 | 点击画面任意处（结算阶段） | 当前动作动画快进到结果 |
| 自动战斗 | 点击回合信息栏右侧 "AUTO" 按钮 | 玩家也由 AI 自动选择动作 |
| 战斗速度 | 点击 "x1" / "x2" 按钮 | 结算动画播放速度翻倍 |

**AUTO 按钮**:
- 位置: 回合信息栏右侧 (x=800, y=8)
- 尺寸: 60x24
- 开启时: 绿色高亮 "AUTO"，玩家跳过 ACTION_SELECT 和 TARGET_SELECT

**速度按钮**:
- 位置: AUTO 按钮左侧 (x=730, y=8)
- 尺寸: 50x24
- 切换: x1 (默认) ↔ x2 (所有动画持续时间减半)

---

## 四、色彩方案

### 4.1 主色调定义

游戏采用暗色系像素风格，参考梦幻西游的沉稳感 + 曹操传的精致度。

#### 基础色板（v1.1 — 暖金色调）

> 以 ui-prototype/index.html CSS 变量为准

| 用途 | 颜色代码 | 色名 | 说明 |
|------|---------|------|------|
| 主背景 | `#08060E` | 深紫黑 | 战斗场景背景底色 |
| 副背景 | `#0E0C18` | 暗夜紫 | 面板/对话框背景 |
| 面板色 | `rgba(14,10,22,0.92)` | 半透明暗紫 | 按钮、卡片的深色底 |
| 主金色 | `#C8A050` | 暖金 | 边框、装饰、核心强调 |
| 亮金色 | `#E8C870` | 亮金 | 选中状态、标题、玩家标识 |
| 暗金色 | `#8A6A30` | 暗金 | 次要边框、阴影 |
| 腥红 | `#CC3333` | 暗红 | HP低值、伤害数字 |
| 天蓝 | `#4488CC` | 碧蓝 | MP条、MP消耗标记 |
| 怒橙 | `#FF6600` | 怒橙 | RAGE条 |
| 正文色 | `#F5E6C8` | 奶白 | 正文、角色名 |
| 辅文色 | `#9A8A70` | 暗金灰 | 次要文字、提示 |

#### 战斗场景背景

```
背景: radial-gradient(ellipse at 50% 55%, #141020, #08060E)
地面: 渐变 rgba(30,22,12,0.3) → transparent
地面线: rgba(200,160,80,0.08) 水平渐变
暗角: radial-gradient vignette
```

### 4.2 UI 面板颜色

| 元素 | 背景色 | 边框色 | 备注 |
|------|--------|--------|------|
| 回合信息栏 | `rgba(0,0,0,0.6)` | `#445566` | 顶部横条 |
| 动作面板 | `rgba(15,15,25,0.85)` | `#445566` | 底部右侧 |
| 战斗日志 | `rgba(0,0,0,0.7)` | `#333333` | 底部左侧 |
| 技能按钮 (正常) | `#1A2744` | `#334466` | |
| 技能按钮 (hover) | `#243458` | `#5588AA` | 亮度提升 |
| 技能按钮 (选中) | `#2A3A5E` | `#FFD700` | 金色边框 |
| 技能按钮 (禁用) | `#151515` | `#222222` | opacity: 0.4 |
| 角色名牌背景 | `rgba(0,0,0,0.5)` | 无 | 名牌底板 |
| tooltip | `rgba(20,20,35,0.95)` | `#556677` | 技能说明弹窗 |

### 4.3 资源条颜色

| 资源 | 填充色 | 低值色 | 背景槽色 | 变化动画色 |
|------|--------|--------|---------|-----------|
| HP | `#22CC44` | `#CC2222` (<25%) | `rgba(0,0,0,0.5)` | 减少时红色闪烁 |
| MP | `#4488FF` | `#6644AA` (<25%) | `rgba(0,0,0,0.5)` | 减少时蓝色残影 |
| RAGE | `#FF6600` | -- | `rgba(0,0,0,0.5)` | 增加时橙色脉冲 |
| RAGE (>= 60) | `#FF8800` + 发光 | -- | `rgba(0,0,0,0.5)` | 持续脉冲发光 |

### 4.4 文字颜色

| 用途 | 颜色 | 代码 |
|------|------|------|
| 正常文字 | 浅灰白 | `#DDDDDD` |
| 标题文字 | 白色 | `#FFFFFF` |
| 玩家名 | 金色 | `#FFD700` |
| AI名 | 灰白 | `#BBBBBB` |
| 系统提示 | 灰色 | `#AAAAAA` |
| 伤害数字 | 红色 | `#FF3333` |
| 真实伤害 | 紫色 | `#FF00FF` |
| 治疗/增益 | 绿色 | `#44FF88` |
| 闪避/Miss | 橙色 | `#FFAA00` |
| 克制/触发 | 天蓝 | `#55CCFF` |
| 击杀文字 | 亮红 | `#FF0000` |
| 禁用/不可用 | 深灰 | `#555555` |
| MP 消耗标记 | 浅蓝 | `#6699CC` |
| RAGE 消耗标记 | 橙色 | `#CC8844` |
| HP 消耗标记 | 暗红 | `#CC6666` |

### 4.5 角色标识色

每个角色有专属的主题色，用于名牌下划线、选中框等细节。

| 角色 | 主题色 | 代码 | 用途 |
|------|--------|------|------|
| 骑士 | 皇家蓝 | `#4466CC` | 名牌下划线、选中光效 |
| 装甲战士 | 铁灰红 | `#AA4444` | 名牌下划线、选中光效 |
| 弓箭手 | 森林绿 | `#44AA66` | 名牌下划线、选中光效 |

### 4.6 特效颜色

| 特效 | 主色 | 辅色 | 备注 |
|------|------|------|------|
| 斩击光效 | `#FFFFFF` | `#FFDDAA` | 白色→金色渐隐 |
| 箭矢轨迹 | `#DDDDDD` | `#AAAAAA` | 白灰色 |
| 金色光箭 (太阳之弓) | `#FFD700` | `#FFAA00` | 金色发光 |
| 彩虹箭矢 | 彩虹渐变 | -- | 红→橙→黄→绿→蓝→紫 |
| 防御盾牌 | `#4488FF` | `#2266CC` | 蓝色半透明 |
| 顶盾护罩 | `#44AAFF` | `#2288DD` | 蓝色光罩 |
| 反震波纹 | `#AA44FF` | `#7722CC` | 紫色波纹 |
| 反弹伤害线 | `#FF44FF` | `#CC22CC` | 紫粉色闪电 |
| 马鞭加速 | `#FFDD44` | `#DDBB22` | 金色速度线 |
| 游击战术 | `#44FF88` | `#22DD66` | 绿色速度残影 |
| 漫天花雨 | `#FF4444` | `#CC2222` | 红色箭雨 + 暗色天空 |
| 死亡碎片 | `#888888` | `#444444` | 灰色碎片粒子 |
| 怒气满特效 | `#FF6600` | `#FF8800` | 橙色火焰光环 |

---

## 五、附录

### 5.1 响应式适配策略

游戏容器使用响应式尺寸（100vw × 100vh，max 1440×900），内部逻辑以 960×540 为基准：
- 15寸MacBook Pro：填满整个浏览器窗口（effective 1440×900）
- 更大屏幕：居中显示，max-width/max-height 限制
- 更小屏幕：等比缩小适配
- CSS `image-rendering: pixelated` 确保像素风锐利缩放

### 5.2 画面帧率

- 目标帧率: 60 FPS
- 待机动画帧率: 8~12 FPS（角色精灵帧动画）
- UI 动画: 60 FPS（Tween 补间动画）
- 粒子特效: 60 FPS

### 5.3 音效预留位置

当前版本不包含音效，但 UI 设计中预留了以下音效触发点：
- 按钮点击
- 技能释放
- 命中/受击
- 暴击/克制
- 死亡
- 胜利/败北
- 背景音乐（战斗场景）

---

## 更新日志

| 日期 | 版本 | 更新内容 |
|------|------|----------|
| 2026-02-07 | v1.0 | 初始版本：屏幕流转图、战斗界面布局规格、回合交互流程、色彩方案 |
| 2026-02-08 | v1.1 | **审计同步**：(1)配色方案从冷蓝系改为暖金系（同步原型）；(2)布局从弧形改为玩家底部+对手上方动态布局；(3)画布从960×540固定改为响应式(max 1440×900)；(4)反震时序修正（RESOLVE阶段结算，非TURN_START）；(5)标注原型为视觉设计权威来源 |
